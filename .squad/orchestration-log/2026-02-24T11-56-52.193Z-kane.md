# Kane — Aspire Vite Fix Session

**Date:** 2026-02-24T11-56-52.193Z  
**Agent:** Kane (DevOps & Aspire Specialist)  
**Mode:** Background  

## Summary

Fixed AppHost.cs to use `AddNpmApp` with `.WithReference(api)` for proper Aspire-to-Vite service discovery injection.

## Work Done

1. **Closed GitHub issue #28** — Not directly related to current work (issue was for theme migration completed in PR #27)
2. **Fixed AppHost.cs:**
   - Replaced invalid `AddViteApp()` (non-existent method) with `AddNpmApp("frontend", "../../frontend", "dev")`
   - Added `.WithReference(api)` to inject service discovery env vars (`services__api__http__0`, `services__api__https__0`)
   - Added `.WithEnvironment("BROWSER", "none")` to prevent auto-browser-open
   - Kept `.WaitFor(api)` to ensure API starts first
3. **Committed and pushed** — Commit `778442a` for WithReference pattern

## Decisions Made

- **Use AddNpmApp with WithReference:** Standard Aspire pattern for injecting service URLs into npm processes
- **Why not AddViteApp:** Method doesn't exist in Aspire 9.3.0; AddNpmApp is correct for npm-based projects

## Outcomes

- AppHost.cs now correctly injects API URL into Vite process at runtime
- Frontend can use `import.meta.env.services__api__http__0` in vite.config.ts to proxy requests
- Works with dynamic port assignment
- Proper Aspire service reference pattern

## Dependencies/Handoffs

- Parker: Use the injected env vars in vite.config.ts to configure Vite proxy (see parker-aspire-proxy.md)
