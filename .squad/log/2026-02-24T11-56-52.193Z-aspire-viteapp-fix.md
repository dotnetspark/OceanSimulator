# Session Log: Aspire Vite App Fix

**Date:** 2026-02-24T11-56-52.193Z  
**Topic:** Aspire Vite App Integration  
**Agents:** Kane (DevOps), Parker (Frontend)  

## Session Summary

Completed Aspire orchestration configuration for Vite frontend integration. Kane fixed AppHost.cs with proper service reference injection; Parker configured vite.config.ts to read service discovery environment variables.

## Key Outcomes

1. **AppHost Service Reference Pattern (Kane)**
   - Replaced non-existent `AddViteApp()` with `AddNpmApp("frontend", "../../frontend", "dev")`
   - Added `.WithReference(api)` to inject service discovery env vars into Vite process
   - Pattern: `services__api__http__0` and `services__api__https__0` (lowercase, double underscores)
   - Commit: `778442a`

2. **Vite Proxy Configuration (Parker)**
   - Updated vite.config.ts to read Aspire service discovery env vars
   - Proxy forwards `/api` requests to dynamically discovered backend URL
   - Gracefully disables when running standalone (env vars not set)
   - Added `host: true` for Aspire port forwarding support
   - Commit: `11a3ced`

3. **Issues Discovered**
   - Frontend code still uses hardcoded localhost URLs:
     - `simulationApi.ts`: `VITE_API_URL ?? 'http://localhost:5030'`
     - `useSignalR.ts`: `VITE_API_URL ?? 'http://localhost:5000'` (different port!)
   - Follow-up required: Update these to use relative paths (`/api`, `/hubs/simulation`)

## Decisions Recorded

- **kane-viteapp-reference.md:** Use AddNpmApp with WithReference for service URL injection
- **parker-aspire-proxy.md:** Configure Vite proxy with Aspire service discovery env vars

## Dependencies

- Previous: Kane (AppHost WithReference implementation) âœ“
- Follow-up: Parker needs to update simulationApi.ts and useSignalR.ts hardcoded URLs
- Related: Issue #28 (closed, unrelated theme work)
